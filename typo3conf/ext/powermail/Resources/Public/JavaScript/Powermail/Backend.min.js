function PowermailBackend(e){"use strict";this.initialize=function(){i(),t(),a(),n(),o(),l(),r(),s(),d(),c(),f(),u(),p(),m(),v()};var i=function(){e('*[data-action="openPowermailDetails"]').click(function(){var i=e(this);i.closest("tr").find(".icon:first").toggle();var t=i.closest("tr").find(".openPowermailDetailsIcons .icon:last");t.is(":visible")?t.css("display","none"):t.css("display","inline-block"),i.closest("tr").next().toggleClass("powermail_listbe_details_closed").find(".powermail_listbe_details_container").slideToggle()})},t=function(){e(document).on("click",".unhideMail, .hideMail",function(){var i=e(this),t=i.closest("td").find(".container_module_uri").val(),a=i.closest("td").find(".container_uid").val(),n=i.closest("td").find(".container_table").val(),o=h(i.closest("tr"));w(n,a,o,t)})},a=function(){e(document).on("click",'*[data-action="deleteMail"]',function(){var i=e(this),t=i.closest("td").find(".container_module_uri").val(),a=i.closest("td").find(".container_uid").val(),n=i.closest("td").find(".container_table").val(),o=i.closest("td").find(".container_label_delete_confirmation").val();confirm(o)&&(b(i.closest("tr")),_(n,a,t))})},n=function(){e(".powermail_list .pagination a").click(function(i){i.preventDefault();for(var t=e(this).prop("href"),a=t.split("&"),n="",o=0;o<a.length;o++)a[o].indexOf("widget")!==-1&&(n=a[o]);if(""!==n){var l=n.split("=");l[0]=l[0].replace("%40","@");var r='<input type="hidden" name="'+l[0]+'" value="'+l[1]+'" />',s=e("#powermail_module_search");s.append(decodeURI(r)),s.submit()}return!1})},o=function(){e("a.sorting").click(function(i){i.preventDefault();for(var t=e(this).prop("href"),a=t.split("&"),n="",o=0;o<a.length;o++)a[o].indexOf("sorting")!==-1&&(n=a[o]);if(""!==n){var l=n.split("=");l[0]=l[0].replace("%40","@");var r=e('.extended_export_sorting_container[name="'+decodeURI(l[0])+'"]');r.length&&r.remove();var s='<input type="hidden" name="'+l[0]+'" value="'+l[1]+'" />',d=e("#powermail_module_search");d.append(decodeURI(s)),d.submit()}})},l=function(){e(".addPowermailSelection").click(function(){g(e(this)),C()})},r=function(){e(".addPowermailSelectionAll").click(function(){e(".addPowermailSelection").each(function(){g(e(this))}),C()})},s=function(){e(".powermailSelectionDelete").click(function(){x()})},d=function(){e(".powermailSelectionHide").click(function(){y(e)})},c=function(){e("#extended_search input, #extended_search select").not('*[type="submit"]').each(function(){if(""!==e(this).val())return void e("#extended_search").addClass("in")})},f=function(){e.fn.datetimepicker&&(e('input[data-datepicker="true"]').each(function(){var i=e(this),t=!0,a=!0;"date"===i.data("datepicker-settings")?a=!1:"time"===i.data("datepicker-settings")&&(t=!1),i.datetimepicker({format:i.data("datepicker-format"),timepicker:a,datepicker:t,lang:"en",i18n:{en:{months:i.data("datepicker-months").split(","),dayOfWeek:i.data("datepicker-days").split(",")}}})}),e('*[data-datepicker-opener="true"]').click(function(){e(this).prev().datetimepicker("show")}))},u=function(){e(".export_icon_xls, .export_icon_csv").click(function(){e(this).hasClass("export_icon_csv")&&e("#forwardToAction").val("exportCsv"),e(this).hasClass("export_icon_xls")&&e("#forwardToAction").val("exportXls"),e(this).closest("form").submit()}),e('*[data-action="searchall_submit"]').click(function(){e("#forwardToAction").val("list")}),e(".extended_export_title").click(function(){var i=e(this);i.hasClass("powermail-close")?(i.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),i.next().slideDown("",function(){i.next().children("div").children("div").fadeTo("slow",1)})):(i.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),i.next().children("div").children("div").fadeTo("slow",0,function(){i.next().slideUp()}))}),e(function(){e(".extended_export_field, .extended_export_field_container").sortable({connectWith:".connected",update:function(i,t){var a=e(this).prop("id");if("export_field_selection"===a){var n=e(this).sortable("toArray").toString();e("#export_fields").val(n)}}}).disableSelection()})},p=function(){e(".openHiddenTable").click(function(){var i=e(this).closest("tr");i.find(".dots").toggle(),i.find(".hiddenConverterTable").toggle()})},m=function(){e(".powermail_listbe_details_dd.powermail_listbe_details_type_password").html("********")},v=function(){var i=e(".powermail_reporting_form_fields_table");i.find("tr:even").addClass("even"),i.find("tr:first").removeClass("even"),i.find("tr").hide(),i.find("tr:first").show(),i.find("th").click(function(){var i=e(this);i.hasClass("powermail-close")?i.removeClass("powermail-close").addClass("powermail-open"):i.removeClass("powermail-open").addClass("powermail-close"),i.parent().siblings().slideToggle("fast")}),e('*[data-flot-active="1"]').each(function(){for(var i=e(this),t=[],a=P(i.data("flot-data-values"),","),n=P(i.data("flot-data-labels"),","),o=P(i.data("flot-data-colors"),","),l=0;l<a.length;l++){var r={data:a[l],label:n[l],color:o[l]};t.push(r)}e.plot(i,t,{series:{pie:{show:!0,innerRadius:.5,radius:1,opacity:.3,color:"#FF0000",label:{show:!0,radius:1,formatter:j,background:{opacity:.8}},combine:{color:"#999",threshold:.1}}},grid:{hoverable:!0,clickable:!0}}),i.bind("plothover",function(i,t,a){if(a){var n=parseFloat(a.series.percent).toFixed(2);e("#hover").html("<span style='font-weight:bold; color:"+a.series.color+"'>"+a.series.label+" ("+n+"%)</span>")}}),i.bind("plotclick",function(e,i,t){if(t){var a=parseFloat(t.series.percent).toFixed(2);alert(""+t.series.label+": "+a+"%")}})})},h=function(e){var i=e.find(".visibilityButton"),t=0;return i.hasClass("unhideMail")?(i.removeClass("unhideMail").removeClass("fa-toggle-off").addClass("hideMail").addClass("fa-toggle-on"),e.find(".powermailRecordIcon").children(":first").removeClass("hide"),e.find(".powermailRecordIcon").children(":last").addClass("hide")):(i.removeClass("hideMail").removeClass("fa-toggle-on").addClass("unhideMail").addClass("fa-toggle-off"),e.find(".powermailRecordIcon").children().last().removeClass("hide"),e.find(".powermailRecordIcon").children().first().addClass("hide"),t=1),t},w=function(i,t,a,n){var o=n+"&data["+i+"]["+t+"][hidden]="+a;e.ajax({url:o})},_=function(i,t,a){var n=a+"&cmd["+i+"]["+t+"][delete]=1";e.ajax({url:n})},b=function(e){e.fadeOut("slow",function(){e.next().remove(),e.remove()})},g=function(e){e.hasClass("fa")?e.toggleClass("fa-plus").toggleClass("fa-minus").closest("tr").toggleClass("selectLine"):e.toggleClass("t3-icon-view-table-expand").toggleClass("t3-icon-view-table-collapse").closest("tr").toggleClass("selectLine")},C=function(){var i=e(".selectLine").length;e(".selectedLineMessage_numbers").html(i),i>0?e(".selectedLineMessage").show():e(".selectedLineMessage").hide()},x=function(){e(".selectLine").each(function(){var i=e(this),t=i.children(":last"),a=t.find(".container_module_uri").val(),n=t.find(".container_uid").val(),o=t.find(".container_table").val();_(o,n,a),b(i),k(i)}),C()},k=function(e){var i=e.find(".addPowermailSelection");g(i)},y=function(){e(".selectLine").each(function(){var i=e(this),t=i.children(":last"),a=t.find(".container_module_uri").val(),n=t.find(".container_uid").val(),o=t.find(".container_table").val();w(o,n,h(i),a),k(i)}),C()},P=function(e,i){if(e.toString().indexOf(i)!==-1)var t=e.split(i);else t=[e];return t},j=function(e,i){return'<div class="flotLabel">'+e+"<br/>"+Math.round(i.percent)+"%</div>"};window.PowermailBackend=PowermailBackend}requirejs.config({map:{"*":{"jquery.flot.min":"TYPO3/CMS/Powermail/Libraries/jquery.flot.min"}},shim:{"TYPO3/CMS/Powermail/Libraries/jquery-ui.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.datetimepicker.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.min":{deps:["jquery"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min":{deps:["jquery","TYPO3/CMS/Powermail/Libraries/jquery.flot.min"],exports:"jQuery"},"TYPO3/CMS/Powermail/Libraries/bootstrap.min":{deps:["jquery"],exports:"jQuery"}}}),define(["jquery","TYPO3/CMS/Powermail/Libraries/jquery-ui.min","TYPO3/CMS/Powermail/Libraries/jquery.datetimepicker.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.min","TYPO3/CMS/Powermail/Libraries/jquery.flot.pie.min","TYPO3/CMS/Powermail/Libraries/bootstrap.min"],function(e){e(document).ready(function(e){var i=new window.PowermailBackend(e);i.initialize()})});